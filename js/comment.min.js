jQuery(document).ready(function(){var a=jQuery(".kazi-comments > .kazi_comment_form_holder");kazi_comment.generateFormHTML(a);kazi_comment.fetchComments()});kazi_comment=function(){return{saveComment:function(f,b,d,a){var c={subset_id:kazist_document.extension_path,record_id:kazist_document.record_id,comment:f,parent_id:d,comment_id:b,attachments:a};var e=kazist.callAjaxByRoute("notification.comments.savecomment",c);kazi_comment.commentsHtml(e)},deleteComment:function(a){var b={subset_id:kazist_document.extension_path,record_id:kazist_document.record_id,comment_id:a};var c=kazist.callAjaxByRoute("notification.comments.deletecomment",b);kazi_comment.commentsHtml(c)},fetchComments:function(){var a={subset_id:kazist_document.extension_path,record_id:kazist_document.record_id};var b=kazist.callAjaxByRoute("notification.comments.fetchcomment",a);kazi_comment.commentsHtml(b)},commentsHtml:function(b){var a="";console.log(b.successful);if(b.successful){a=kazi_comment.getCommentRecursivelyHtml(b.comments,a);a=jQuery(a);a.find(".kazi_comment_form_holder").hide();a.find(".kazi_reply_comment_btn").on("click",function(){var e=jQuery(this);var d=e.closest(".single-comment");var c=d.find(" > .comment-wrapper >  .kazi_comment_form_holder");kazi_comment.generateFormHTML(c,true)});a.find(".kazi_edit_comment_btn").on("click",function(){var e=jQuery(this);var d=e.closest(".single-comment");var c=d.find("> .comment-wrapper > .kazi_comment_form_holder");var f=d.find("> .comment-wrapper > #comment").val();kazi_comment.generateFormHTML(c,true,f,true)});a.find(".kazi_delete_comment_btn").on("click",function(){b="Note: All Children Comment will be deleted together with this comment. Are you sure you want to delete this comment?";if(confirm(b)){var e=jQuery(this);var c=e.closest(".single-comment");var d=c.find("> .comment-wrapper > #comment_id").val();kazi_comment.deleteComment(d)}});jQuery(".kazi-comments .kazi-comment-list").html(a)}},getCommentRecursivelyHtml:function(b,a){jQuery.each(b,function(e,d){var c=d.attachments;var f="";a+='<div class="single-comment item">';a+='<img src="'+d.avatar+'" align="left" alt="user image" class="online single-comment-image">';a+='<div class="comment-wrapper">';a+='<a href="#" class="name">'+d.user_full_name+'&nbsp; <small class="text-muted"><i class="fa fa-clock-o"></i> '+d.date_created+"</small></a>";a+="<p>";a+=d.comment;a+="</p>";if(c.length){a+='<div class="kazi_comment_attachments_holder attachment">';jQuery.each(c,function(g,h){a+="<span>";a+='<a href="'+kazi.url+"?app=media&com=media&view=edit&cid[]="+h.id+'" target="_blank">';a+='<img src="'+h.file_icon+'" width="24px" style="margin-left:10px"> &nbsp; ';a+="</a>";a+=h.title;a+='<input type="hidden" id="media_id" value="'+h.id+'">';a+='<input type="hidden" id="media_title" value="'+h.title+'">';a+='<input type="hidden" id="media_file_icon" value="'+h.file_icon+'">';a+="</span>"});a+="</div>"}a+='<span class="kazi_comment_posting_info">';a+=' <a class="btn btn-default btn-xs kazi_reply_comment_btn"> Reply </a>';if(kazist_document.user_id===d.created_by){a+=' <a class="btn btn-default btn-xs kazi_edit_comment_btn"> Edit </a>';a+=' <a class="btn btn-default btn-xs kazi_delete_comment_btn"> Delete </a>'}a+="</span>";a+="</p>";a+='<div class="kazi_comment_form_holder attachment"></div>';if(d.children.length){a+=kazi_comment.getCommentRecursivelyHtml(d.children,f)}a+='<input type="hidden" id="parent_id" value="'+d.parent_id+'">';a+='<input type="hidden" id="comment_id" value="'+d.id+'">';a+='<input type="hidden" id="comment" value="'+d.comment+'">';a+="</div>";a+="</div>";a+="</div>"});return a},generateFormHTML:function(a,g,f,b){var e="";var i=Math.ceil(Math.random(100,10000)*10000);if(f===undefined){f=""}var c=(b)?1:0;jQuery(".kazi-comment-list .kazi_comment_form_holder").hide();var h="<div>";h+='<img src="'+kazist_document.web_root+"/"+comment_user_avatar+'">';h+='<div class="textarea-wrapper">';h+='<textarea id="kazi_reply_comments_post" class="comments" name="comments">'+f+"</textarea>";h+='<div class="post-actions">';h+='<div class="post-by pull-left hidden-xs">';h+='Post as: <span class="post-by-name">'+comment_user_name+"</span>";h+="</div>";h+='<button class="kazi_comment_save btn btn-success btn-sm pull-right" type="submit" name="reply_comment"><i class="fa fa-save"></i>Save</button>';h+='<a class="kazi_comment_attachment btn btn-primary btn-sm pull-right" data-toggle="modal" data-target="#mediaModal" field_name="'+i+'" application_name="notification" component_name="comments" subset_name="comments" saving_type="multiple" for_comment="1"><i class="fa fa-upload"></i> Attach </a> &nbsp;';h+='<input class="kazi_comment_editing" type="hidden" name="editing" value="'+c+'">';h+="</div>";h+="</div>";h+='<div class="comment_attachment_'+i+'">';h+="<ul>";if(b){var d=a.closest(".single-comment").find("> .comment-wrapper > .kazi_comment_attachments_holder > span");d.each(function(){attachment=jQuery(this);var k=attachment.find("#media_id").val();var j=attachment.find("#media_title").val();var l=attachment.find("#media_file_icon").val();h+='<li style="margin-top:10px;"><a class="label label-danger delete_media"><span class="glyphicon glyphicon-trash"></span></a>&nbsp; <img src="'+l+'" width="24px"> &nbsp; '+j+'<input class="comment_attachment_ids" value="'+k+'" type="hidden"></li>'})}h+="</ul>";h+="</div>";h+="</div>";h=jQuery(h);h.find(".delete_media").on("click",function(){media_manager.deleteLiHtml(jQuery(this))});h.find(".kazi_comment_attachment").on("click",function(){var j=jQuery(this);media_manager.prepareDefaults(j)});h.find(".kazi_comment_save").on("click",function(){var k=Array();var n="";var m="";var p=jQuery(this).closest(".kazi_comment_form_holder").find(".comments").val();var l=jQuery(this).closest(".kazi_comment_form_holder").find(".kazi_comment_editing").val();var j=jQuery(this).closest(".single-comment");var o=jQuery(this).closest(".attachment").find(".comment_attachment_ids");if(j.length){n=j.find("> .comment-wrapper > #parent_id").val();m=j.find("> .comment-wrapper > #comment_id").val();if(!parseInt(l)){n=m;m=""}}o.each(function(){var q=jQuery(this).val();k.push(q)});if(p!==""){kazi_comment.saveComment(p,m,n,k)}jQuery(this).closest(".kazi_comment_form_holder").find(".comments").val("");jQuery(this).closest(".attachment").find(".comment_attachment_ids").closest("ul").remove();return false});if(g){a.show()}a.html(h)}}}();